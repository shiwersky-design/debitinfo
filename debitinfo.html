<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#8ecae6">
<title>Izvornic</title>

<!-- Favicon -->
<link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">

<!-- Apple touch icon (–¥–ª—è iOS) -->
<link rel="apple-touch-icon" href="icon-512.png">

<!-- PWA manifest (–µ—Å–ª–∏ –±—É–¥–µ—Ç) -->
<link rel="manifest" href="manifest.json">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- –°—Ç–∏–ª–∏ -->
<style>
/* ...—Ç–≤–æ–π CSS –æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π... */
</style>
</head>


<style>
/* ===== –û–±—â–∏–µ —Å—Ç–∏–ª–∏ ===== */
html, body {
    margin: 0;
    height: 100%;
    width: 100%;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    overflow: hidden;
}

body.debit-bg {
    background: radial-gradient(100% 100% at var(--4-x-position, 20%) var(--4-y-position, 80%), #91ebfd -8%, transparent),
                radial-gradient(100% 100% at var(--5-x-position, 80%) var(--5-y-position, 20%), #ffffff 0%, transparent),
                #6196ff;
    background-attachment: fixed;
    background-repeat: no-repeat;
    background-size: cover;
    transition: background 0.3s ease;
}

body.animate-bg {
    animation: main 4s infinite ease-in-out;
}

@property --4-x-position { syntax: '<percentage>'; inherits: false; initial-value: 20%; }
@property --4-y-position { syntax: '<percentage>'; inherits: false; initial-value: 80%; }
@property --5-x-position { syntax: '<percentage>'; inherits: false; initial-value: 80%; }
@property --5-y-position { syntax: '<percentage>'; inherits: false; initial-value: 20%; }

@keyframes main {
    25% { --4-x-position: 15%; --4-y-position: 15%; --5-x-position: 85%; --5-y-position: 80%; }
    50% { --4-x-position: 80%; --4-y-position: 15%; --5-x-position: 15%; --5-y-position: 85%; }
    100% { --4-x-position: 20%; --4-y-position: 80%; --5-x-position: 80%; --5-y-position: 20%; }
}

/* ===== –•–µ–¥–µ—Ä ===== */
.header {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 70px;
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    z-index: 1000;
}

.header h1 {
    margin: 0;
    font-size: 1.4rem;
    font-weight: 700;
    color: #073144;
}

.right-controls {
    display: flex;
    align-items: center;
    gap: 10px;
}

.tab {
    background: rgba(255,255,255,0.95);
    padding: 8px 14px;
    border-radius: 6px;
    color: #073144;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    cursor: pointer;
    font-weight: 700;
}

.tab.inactive { opacity: 0.6; }

.menu-btn {
    background: rgba(255,255,255,0.95);
    border-radius: 6px;
    padding: 4px 12px;
    color: #073144;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    cursor: pointer;
    font-size: 1.3rem;
}

.menu-dropdown {
    position: absolute;
    right: 0;
    top: 46px;
    background: #fff;
    border-radius: 6px;
    box-shadow: 0 8px 30px rgba(13,49,78,0.12);
    overflow: hidden;
    min-width: 180px;
    display: none;
}

.menu-dropdown.show { display: block; }

.menu-item {
    padding: 12px 14px;
    border-bottom: 1px solid rgba(0,0,0,0.05);
    color: #073144;
    cursor: pointer;
}

.menu-item:last-child { border-bottom: none; }

/* ===== –°–µ–∫—Ü–∏–∏ ===== */
.section {
    position: absolute;
    top: 70px;
    left: 0;
    right: 0;
    bottom: 0;
    opacity: 0;
    pointer-events: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    transition: opacity 0.3s ease;
}

.section.active {
    opacity: 1;
    pointer-events: auto;
}

/* ===== –î–µ–±–∏—Ç ===== */
h1.debit-title { font-size: 1.8rem; margin: 10px 0 4px; }
.subtitle { font-size: 1rem; color:#0d314e; margin-bottom: 30px; }

.container {
    width: 100%;
    max-width: 400px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    padding: 20px;
    box-sizing: border-box;
}

.input-card {
    background: #fff;
    border-radius: 6px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    padding: 16px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.input-card label { font-weight: 600; font-size: 0.95rem; }

.input-card input {
    border: none;
    background: #f5f5f5;
    border-radius: 6px;
    width: 100px;
    text-align: center;
    font-size: 2.1rem;
    color: #0d314e;
    font-weight: 700;
    padding: 6px 0;
    font-family: inherit;
    letter-spacing: -0.5px;
    -webkit-text-size-adjust: none;
    appearance: none;
}

.grid {
    display: grid;
    grid-template-columns: repeat(2,1fr);
    gap: 20px;
}

.card {
    background: #fff;
    border-radius: 6px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    text-align: center;
    padding: 22px 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.card h2 { font-size: 2.1rem; margin: 0; font-weight: 700; min-height: 48px; }
.card p { font-size: 0.8rem; margin: 6px 0 0; }

#startBtn {
    background: #007aff;
    color: #fff;
    font-size: 1.5rem;
    border: none;
    border-radius: 6px;
    padding: 20px 0;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s;
}

#startBtn.active { background: #ff3b30; }

.message-bubble {
    position: relative;
    background: linear-gradient(135deg, #34c759, #2ebd50);
    color: white;
    font-size: 1.05rem;
    font-weight: 400;
    padding: 14px 18px;
    border-radius: 30px 30px 0 30px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    max-width: 100%;
    text-align: left;
    align-self: flex-end;
    margin: 40px auto 0;
    opacity: 0;
    transform: translateY(30px);
}

@keyframes bubbleUp {
    0% { opacity:0; transform:translateY(30px);}
    100% { opacity:1; transform:translateY(0);}
}

@keyframes shake {
    0% { transform: translateX(0);}
    20% { transform: translateX(-6px);}
    40% { transform: translateX(6px);}
    60% { transform: translateX(-4px);}
    80% { transform: translateX(4px);}
    100% { transform: translateX(0);}
}

/* ===== –ö–∞—Ä—Ç–∞ ===== */
#map { position: absolute; top:0; left:0; right:0; bottom:0; z-index:1; display:none; }
#map.active { display:block; }

.modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(13,49,78,0.35);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}

.modal-backdrop.show { display: flex; }

.modal {
    max-width: calc(100% - 40px);
    background: #fff;
    border-radius: 14px;
    padding: 18px;
    box-shadow: 0 12px 40px rgba(13,49,78,0.16);
}

.input-row {
    display: flex;
    gap: 8px;
    margin-bottom: 10px;
}

.input-row input {
    flex: 1;
    padding: 10px 6px;
    border-radius: 6px;
    border: 1px solid rgba(0,0,0,0.06);
}

.buttons {
    display: flex;
    gap: 8px;
    margin-top: 8px;
}

.btn {
    flex: 1;
    padding: 10px 12px;
    border-radius: 6px;
    font-weight: 700;
    border: none;
    cursor: pointer;
}

.btn.primary { background: #007aff; color: #fff; }
.btn.ghost { background: #f5f5f5; }

/* Popup leaflet */
.leaflet-popup-content-wrapper {
    font-size: 1.1rem;
    color: #073144;
    padding: 12px 16px;
    min-width: 180px;
    max-width: 300px;
    line-height: 1.4;
}

.leaflet-popup-content b { font-size: 1.2rem; }

.delete-btn {
    background: #ff3b30;
    color: #fff;
    border: none;
    border-radius: 6px;
    padding: 8px 14px;
    font-weight: 700;
    cursor: pointer;
    margin-top: 20px;
    width: 100%;
    text-align: center;
}

.delete-btn:hover { background: #e02a20; }
</style>
</head>

<body class="debit-bg animate-bg">

<!-- ===== Header ===== -->
<div class="header">
    <h1>IZVORNIC</h1>
    <div class="right-controls">
        <div class="tab active" id="debitTab">–î–µ–±–∏—Ç</div>
        <div class="tab inactive" id="mapTab">–ö–∞—Ä—Ç–∞</div>
        <div class="top-right-menu" style="position: relative;">
            <div class="menu-btn" id="menuBtn">‚ãÆ</div>
            <div class="menu-dropdown" id="menuDropdown">
                <div class="menu-item" id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç (JSON)</div>
                <div class="menu-item" id="importBtn">–ò–º–ø–æ—Ä—Ç (JSON)</div>
                <div class="menu-item" id="toggleLayerBtn">–ü–æ–∫–∞–∑–∞—Ç—å —Å–ª–æ–π –≥–æ—Ä–∏–∑–æ–Ω—Ç–æ–≤</div>
                <div class="menu-item" id="clearBtn">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</div>
            </div>
        </div>
    </div>
</div>

<!-- ===== –î–µ–±–∏—Ç ===== -->
<div class="section active" id="debitSection">
    <div class="container">
        <div class="input-card">
            <label for="volume">ü™£ –ó–∞–ø–æ–ª–Ω—è–µ–º—ã–π –æ–±—ä—ë–º</label>
            <input type="number" id="volume" value="0" inputmode="numeric">
        </div>
        <div class="grid">
            <button id="startBtn">–°—Ç–∞—Ä—Ç</button>
            <div class="card">
                <h2 id="time">0.0</h2>
                <p>‚è± –í—Ä–µ–º—è, —Å–µ–∫—É–Ω–¥—ã</p>
            </div>
            <div class="card">
                <h2 id="lpm">0.0</h2>
                <p>üíß –õ–∏—Ç—Ä—ã / –º–∏–Ω</p>
            </div>
            <div class="card">
                <h2 id="lph">0.0</h2>
                <p>üí¶ –õ–∏—Ç—Ä—ã / —á–∞—Å</p>
            </div>
        </div>
        <div id="bubble" class="message-bubble">–î–∞–≤–∞–π –∑–∞–º–µ—Ä–∏–º —Ç–≤–æ–π –Ω–∞–ø–æ—Ä ... üí¶ üòÇ üí™</div>
    </div>
</div>

<!-- ===== –ö–∞—Ä—Ç–∞ ===== -->
<div class="section" id="mapSection">
    <div id="map"></div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <div class="modal-backdrop" id="modalBackdrop">
        <div class="modal">
            <h3>–î–æ–±–∞–≤–∏—Ç—å –°–∫–≤–∞–∂–∏–Ω—É</h3>
            <div id="coordText" style="font-size:0.9rem;color:rgba(13,49,78,0.7);margin-bottom:8px;"></div>
            <div class="input-row">
                <input id="inputName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" />
                <input id="inputDepth" placeholder="–ì–ª—É–±–∏–Ω–∞ (–º)" type="number" />
            </div>
            <div class="input-row">
                <input id="inputDebit" placeholder="–î–µ–±–∏—Ç (–ª/—á)" type="number" />
            </div>
            <div class="buttons">
                <button class="btn ghost" id="cancelBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn primary" id="saveBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <input type="file" id="fileInput" accept="application/json" style="display:none" />
</div>

<!-- ===== –°–∫—Ä–∏–ø—Ç ===== -->
<script>
// ===== –í–∫–ª–∞–¥–∫–∏ =====
const debitTab = document.getElementById('debitTab');
const mapTab = document.getElementById('mapTab');
const debitSection = document.getElementById('debitSection');
const mapSection = document.getElementById('mapSection');
const bubble = document.getElementById('bubble');

debitTab.onclick = () => {
    debitTab.classList.add('active'); debitTab.classList.remove('inactive');
    mapTab.classList.remove('active'); mapTab.classList.add('inactive');
    debitSection.classList.add('active'); mapSection.classList.remove('active');
    document.body.classList.add('debit-bg','animate-bg');

    requestAnimationFrame(() => {
        resetValues();
        bubble.style.animation = 'none';
        bubble.offsetHeight; // —Å–±—Ä–æ—Å
        bubble.style.animation = 'bubbleUp 0.3s ease forwards';
    });
};

// ===== –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–µ–±–∏—Ç–∞ =====
let startBtnEl = document.getElementById('startBtn');
let timeEl = document.getElementById('time');
let lpmEl = document.getElementById('lpm');
let lphEl = document.getElementById('lph');
let volumeEl = document.getElementById('volume');
let startTime, timerInterval, running=false, lastMessageIndex=-1;

const resultMessages = [
  '–í–µ–¥—Ä–æ –≤ —à–æ–∫–µ –æ—Ç —Ç–≤–æ–µ–≥–æ –Ω–∞–ø–æ—Ä–∞! –ü—Ä—è–º–æ —Ñ–æ–Ω—Ç–∞–Ω–∏—Ç üòÇ',
  '–°–º–æ—Ç—Ä–∏, –∫–∞–∫ —Å—Ç—Ä—É—è –±—å—ë—Ç! –ü–æ—á—Ç–∏ –∫–∞–∫ —Ñ–æ–Ω—Ç–∞–Ω –≤ –ø–∞—Ä–∫–µ! üíßüòÇ',
  '–í–µ–¥—Ä–æ –Ω–µ –≤—ã–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–∞–∫–æ–≥–æ –Ω–∞–ø–æ—Ä–∞, –¥–µ—Ä–∂–∏—Å—å! –ü–æ—Ö–æ–∂–µ, –ø–µ—Å–æ–∫ –∫—Ä—É–ø–Ω—ã–π. üò± ü§£',
  '–ü–æ—Ç–æ–∫ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –≥—Ä–∞–Ω–∏—Ü—ã ‚Äì –≤–µ–¥—Ä–æ –≤ –≤–æ—Å—Ç–æ—Ä–≥–µ! üòé',
  '–î–µ–¥ –≥–æ–≤–æ—Ä–∏—Ç: ‚Äú–ú–æ—â–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫, –∞ –º—ã —Ç—É—Ç —Å –≤–µ–¥—Ä–æ–º‚Ä¶ –ù–∞–¥–æ –±—ã –±–æ—á–∫—É –ø—Ä–∏—Ç–∞—â–∏—Ç—å!‚Äù ü§™ üòÇ',
  '–î–µ–¥ —Å–∫–∞–∑–∞–ª: ‚Äú–¢–∞–∫–æ–π –Ω–∞–ø–æ—Ä —è —Ç–æ–ª—å–∫–æ –≤ –ü–ª–∏–æ—Ü–µ–Ω–µ –≤–∏–¥–µ–ª!‚Äù üòÇ üí¶',
  '–ò—Å—Ç–æ—á–Ω–∏–∫ —è–≤–Ω–æ —Å–∏–ª—å–Ω—ã–π, –ø–æ—Ç–æ–∫ –ø—Ä—è–º –∫–∞–∫ –≤ —É—á–µ–±–Ω–∏–∫–µ –ø–æ –≥–∏–¥—Ä–æ–¥–∏–Ω–∞–º–∏–∫–µ üìò üí¶',
  '–ë—É—Ä–æ–≤–æ–π –¥–µ–¥: ‚Äú–¢–∞–∫–æ–π –¥–µ–±–∏—Ç ‚Äî —Ä–µ–¥–∫–æ—Å—Ç—å! –î–∞–∂–µ –Ω–∞—Å–æ—Å —É–¥–∏–≤–ª—ë–Ω.‚Äù üò≥ üí¶'
];

function showBubble(text,isError=false){
    bubble.textContent = text;
    bubble.style.animation='none';
    bubble.offsetHeight;
    bubble.style.background='linear-gradient(135deg, #34c759, #2ebd50)';
    bubble.style.animation = isError ? 'bubbleUp 0.3s ease forwards, shake 0.4s ease' : 'bubbleUp 0.3s ease forwards';
    if(navigator.vibrate) navigator.vibrate(40);
}

window.addEventListener('load', () => showBubble('–î–∞–≤–∞–π –∑–∞–º–µ—Ä–∏–º —Ç–≤–æ–π –Ω–∞–ø–æ—Ä ... üí¶ üòÇ üí™'));

function resetValues(){
    timeEl.textContent='0.0';
    lpmEl.textContent='0.0';
    lphEl.textContent='0.0';
}

function updateTimer(){
    let elapsed=(Date.now()-startTime)/1000;
    timeEl.textContent=elapsed.toFixed(1);
    let volume=parseFloat(volumeEl.value);
    if(!isNaN(volume)&&volume>0){
        let lpm=(volume/elapsed)*60;
        let lph=lpm*60;
        lpmEl.textContent=lpm.toFixed(1);
        lphEl.textContent=lph.toFixed(1);
    }
}

function stopTimer(){
    clearInterval(timerInterval);
    running=false;
    startBtnEl.classList.remove('active'); 
    startBtnEl.textContent='–°—Ç–æ–ø';
    let index; do{ index=Math.floor(Math.random()*resultMessages.length);}while(index===lastMessageIndex); 
    lastMessageIndex=index;
    showBubble(resultMessages[index]); 
    document.body.classList.remove('animate-bg');
}

startBtnEl.addEventListener('click',()=>{
    if(!running){
        resetValues();
        if(!volumeEl.value || parseFloat(volumeEl.value)<=0){
            showBubble('–í–≤–µ–¥–∏ –ª–∏—Ç—Ä—ã, —è —Ö–æ—á—É –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–π –Ω–∞–ø–æ—Ä! üòèüöÄ',true);
            return;
        }
        running=true;
        startTime=Date.now();
        startBtnEl.classList.add('active');
        startBtnEl.textContent='–°—Ç–æ–ø';
        showBubble('... –ø—Ä–æ–≤–µ—Ä—è—é –º–æ—â—å —Ç–≤–æ–µ–≥–æ –ø–æ—Ç–æ–∫–∞ üòÇ üöÄ');
        timerInterval=setInterval(updateTimer,100);
        document.body.classList.add('animate-bg');
    } else stopTimer();
});

volumeEl.addEventListener('focus',()=>{ if(volumeEl.value==='0'||volumeEl.value==='0.0') volumeEl.value=''; });
document.addEventListener('touchmove',e=>e.preventDefault(),{passive:false});

// ===== –ö–∞—Ä—Ç–∞ –∏ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ =====
let map, geologyLayer, wells = JSON.parse(localStorage.getItem('wells')||'[]'), tempLatLng=null;
let geologyVisible=false;

function saveWells(){ localStorage.setItem('wells', JSON.stringify(wells)); }

function renderMarkers(){
    if(!map) return;
    map.eachLayer(l=>{ if(l instanceof L.Marker) map.removeLayer(l); });
    wells.forEach((w,i)=>{
        const marker = L.marker([w.lat, w.lng]).addTo(map);
        marker.bindPopup(`<b>${w.name}</b><br>–ì–ª—É–±–∏–Ω–∞: ${w.depth} –º<br>–î–µ–±–∏—Ç: ${w.debit} –ª/—á<br><button class="delete-btn" data-index="${i}">–£–¥–∞–ª–∏—Ç—å</button>`);
    });
}

function setupPopupDelete(){
    map.on('popupopen', e=>{
        const btn = e.popup._contentNode.querySelector('.delete-btn');
        if(btn) btn.onclick = ()=>{
            wells.splice(parseInt(btn.dataset.index),1);
            saveWells(); renderMarkers();
        };
    });
}

mapTab.onclick = ()=>{
    mapTab.classList.add('active'); mapTab.classList.remove('inactive');
    debitTab.classList.remove('active'); debitTab.classList.add('inactive');
    mapSection.classList.add('active'); debitSection.classList.remove('active');
    document.body.classList.remove('debit-bg','animate-bg');

    if(!map){
        map = L.map('map').setView([47.0105,28.8638],8);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ attribution:'¬© OpenStreetMap' }).addTo(map);

        geologyLayer = L.tileLayer.wms("https://geologie.gov.md/geoserver/ows?",{
            layers:'geofond:vw_waterbody', format:'image/png', transparent:true, version:'1.1.1',
            attribution:"–ì–ò–° –¥–∞–Ω–Ω—ã–µ: geologie.gov.md", opacity:0.55
        });

        renderMarkers();
        setupPopupDelete();

        map.on('click', e=>{
            tempLatLng=e.latlng;
            document.getElementById('coordText').textContent=`–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${e.latlng.lat.toFixed(6)}, ${e.latlng.lng.toFixed(6)}`;
            document.getElementById('modalBackdrop').classList.add('show');
        });
    }
    document.getElementById('map').classList.add('active');
    setTimeout(()=> map.invalidateSize(),300);
};

// ===== –ú–µ–Ω—é =====
const menuBtn = document.getElementById('menuBtn');
const menuDropdown = document.getElementById('menuDropdown');
menuBtn.onclick = ()=> menuDropdown.classList.toggle('show');

// ===== –°–ª–æ–π –≥–æ—Ä–∏–∑–æ–Ω—Ç–æ–≤ =====
document.getElementById('toggleLayerBtn').onclick = ()=>{
    if(!map) return;
    if(geologyVisible){ map.removeLayer(geologyLayer); geologyVisible=false; }
    else { geologyLayer.addTo(map); geologyVisible=true; }
};

// ===== –û—á–∏—Å—Ç–∫–∞ =====
document.getElementById('clearBtn').onclick = ()=>{
    wells=[]; saveWells(); renderMarkers();
};

// ===== –≠–∫—Å–ø–æ—Ä—Ç / –ò–º–ø–æ—Ä—Ç =====
document.getElementById('exportBtn').onclick = ()=>{
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(wells));
    const dl = document.createElement('a'); dl.href=dataStr; dl.download='wells.json'; dl.click();
};
document.getElementById('importBtn').onclick = ()=> document.getElementById('fileInput').click();
document.getElementById('fileInput').onchange = function(){
    const reader = new FileReader();
    reader.onload = e=>{
        try{ wells=JSON.parse(e.target.result); saveWells(); renderMarkers(); } 
        catch(err){ alert('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞'); }
    };
    reader.readAsText(this.files[0]);
};

// ===== –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è =====
document.getElementById('cancelBtn').onclick = ()=> document.getElementById('modalBackdrop').classList.remove('show');
document.getElementById('saveBtn').onclick = ()=>{
    if(!tempLatLng) return;
    const name=document.getElementById('inputName').value||'–°–∫–≤–∞–∂–∏–Ω–∞';
    const depth=parseFloat(document.getElementById('inputDepth').value)||0;
    const debit=parseFloat(document.getElementById('inputDebit').value)||0;
    wells.push({name,depth,debit,lat:tempLatLng.lat,lng:tempLatLng.lng});
    saveWells(); renderMarkers();
    document.getElementById('modalBackdrop').classList.remove('show');
    document.getElementById('inputName').value='';
    document.getElementById('inputDepth').value='';
    document.getElementById('inputDebit').value='';
};
</script>
</body>
</html>
